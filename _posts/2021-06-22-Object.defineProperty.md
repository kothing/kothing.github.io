---
layout: post
title:  "Object.defineProperty用法详解"
author: Kothing
categories: [ Javascript ]
tags: [Javascript]
image: assets/images/5.jpg
description: "Object.defineProperty用法详解"
rating: 4.5
---

# Object.defineProperty()用法详解
> `Object.defineProperty()` 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性，并返回此对象。

#### 通常给对象添加属性的做法

现有已定义的对象user：
```
let user = {};
```
现在给 `user` 对象增加一个属性 `name`，通常的做法：
```
user.name="妙公子";
console.log(user);
// {name: "妙公子"}
```
如果想要增加一个sayHi方法：
```
user.sayHi = () => {
  console.log("Hi !");
};
console.log(user);
// {name: "妙公子", sayHi: ƒn}
```

#### 使用 `Object.defineProperty()` 的做法
使用`Object.defineProperty()`给user添加name属性：
```
Object.defineProperty(user, 'name', {
  value: '妙公子'
});

console.log(user);
// {name: "妙公子"}
```
---

### 语法
> `Object.defineProperty(object, property, descriptor)`

### 参数
**`object`**: 要定义属性的对象  
**`property`**: 要定义或修改的属性的名称或 Symbol   
**`descriptor`**: 要定义或修改的属性描述符  

descriptor是以对象方法传入：  
```
descriptor: {  
  value: 默认为 undefined,  
  // 该属性对应的值。可以是任何有效的 JavaScript 值（数值，对象，函数等）
  
  writable: 默认为 false,  
  // 当且仅当该属性的 writable 键值为 true 时，属性的值，也就是上面的 value，才能被赋值运算符改变
  
  enumerable: 默认为 false,  
  // 当且仅当该属性的 enumerable 键值为 true 时，该属性才会出现在对象的枚举属性中
  
  configurable: 默认为 false,  
  // 当且仅当该属性的 configurable 键值为 true 时，该属性的描述符才能够被改变，同时该属性也能从对应的对象上被删除
  
  get: 不设置时为 undefined，即默认为undefined。  
  // 属性的 getter 函数，如果没有 getter，则为 undefined。当访问该属性时，会调用此函数。该函数的返回值就是属性的值。
  
  set: 默认为undefined。  
  // 属性的 setter 函数，如果没有 setter，则为 undefined。当属性值被修改时，会调用此函数。该方法接受一个参数（也就是被赋予的新值）。
}
```

### 返回值
返回值为当前对象

### 示例

参数 `descriptor` 各个属性的具体用法。  

#### `value`属性
使用`Object.defineProperty()`给user添加name属性：
```
let user = {};
Object.defineProperty(user, 'name', {
  value: '妙公子'
});

console.log(user);
// {name: "妙公子"}
```
*value可以是任何有效的 JavaScript 值*，所以
```
let user = {};

Object.defineProperty(user,"name",{
 value: "妙公子" // 字符串
});

Object.defineProperty(user,"isSlow",{
 value: true // 布尔型
});

Object.defineProperty(user,"sayHi",{
 value: function () { console.log("Hi !") } // 函数
});

Object.defineProperty(user,"age",{
 value: 12 // 数字
});

Object.defineProperty(user,"birth",{
 value:{
  date:"2018-06-29",
  hour:"15:30"
 } // 日期
});
```

#### `writable` 属性

当 writable 属性设置为 false 时，该属性被称为“不可写的”。它不能被重新赋值。
```
let user = {};

Object.defineProperty(user,"name",{
 value: "妙公子"
});
console.log(user);
```
当前user对象已经有了name属性，值为"妙公子"，我们试着改变name的值：
```
user.name="NiceBoy"
console.log(user);
// {name: "妙公子"}
```
上面代码并没有设置 `writable` 这个值，默认是false，所以属性值不会改变，也不会引发错误。
我们再验证把`writable`设置为true时候能否修改成功
```
let user = {};
Object.defineProperty(user,"name",{
 value: "妙公子",
 writable: true
});
console.log(user);

user.name="NiceBoy"
console.log(user);
// {name: "NiceBoy"}
```
可以看出修改成功

#### `enumerable` 属性
`enumerable` 定义了对象的属性是否可以在 `for...in` 循环和 `Object.keys()` 中被枚举。
```
let user ={
 name: "妙公子",
 age: 25
};
```
如果获取user对象的全部属性，通常做法：
```
let keys=Object.keys(user)
console.log(keys);
// ['name', 'age']

// 或
let keys = [];
for(key in user){
 keys.push(key);
} 
console.log(keys);
// ['name', 'age'] 
```

当使用Object.defineProperty定义user属性时
```
let user ={
 name: "妙公子",
 age: 25
} ;

//定义一个性别 可以被枚举
Object.defineProperty(user, "gender",{
 value: "男",
 enumerable: true
});
 
//定义一个出生日期 不可以被枚举
Object.defineProperty(user, "birth",{
 value: "2020-05-03",
 enumerable: false
});
```
获取(枚举)user属性
```
console.log(user);
// {name: "妙公子", age: 25, gender: "男", birth: "2020-05-03"}

let keys = Object.keys(user);
console.log(keys);
// ["name", "age", "gender"]
```
可以看出 `enumerable=false` 的 `birth` 属性并没有被枚举出来。

#### `configurable` 属性
`configurable` 特性表示对象的属性是否可以被删除，以及除 `value` 和 `writable` 特性外的其他特性(在第一次设置之后)是否可以被修改。
```
let user ={
 name: "妙公子",
 age: 25
} ;

//定义一个性别 不可以被删除和重新定义特性
Object.defineProperty(user, "gender", {
 value: "男",
 enumerable: true,
 configurable: false
});
 
//删除一下
delete user.gender;
console.log(user);
//{name: "妙公子", age: 25, gender: "男"}
 
//重新定义特性
Object.defineProperty(user, "gender", {
 value: "男",
 enumerable: true,
 configurable: true
})
// Uncaught TypeError: Cannot redefine property: gender
//会报错，如下图
```
